#!/usr/bin/env python
# -*- coding: utf-8 -*-
# vim: set hls is ai et sw=4 sts=4 ts=8 nu ft=python:
#
# Copyright Â© 2014 Drake Guan <drakeguan@kkbox.com>
#

# Built-in modules
import os

# Additional modules
import path


# paths of external tools
PATH_OPENSSL = 'openssl'
PATH_AWSCLI = 'aws'
PATH_FFMPEG = 'ffmpeg'
PATH_FFPROBE = 'ffprobe'
PATH_MP4BOX = 'MP4Box'
PATH_MP4EXTRACT = 'mp4extract-bento'
PATH_MP4TRACT = 'mp4track'
PATH_PHP = 'php'
PATH_PANDOC = 'pandoc'


# logging variables
LOG_FILENAME = '/tmp/videopass-encoding-benchmark.txt'
FLUENT_HOST = 'localhost'
FLUENT_PORT = 24224
FLUENT_TAG_PREFIX = 'videopass.encoder'


# general variables
MOVIE_EXTS = ('.mov', '.mp4', '.mpeg', '.mpg', '.ts', 'm2ts', 'm2v')


# transcoding variables
AUDIO_BITRATES = (48, 64, 64,
                  64,
                  96, 96, 96,
                  128, 192,
                  96, 96, 96,
                  128, 192)
VIDEO_BITRATES = (80, 150, 350,
                  500,
                  700, 1200, 2000,
                  4000, 7000,
                  700, 1200, 2000,
                  4000, 7000)
RESOLUTIONS = ('426x240', '426x240', '426x240',
               '640x360',
               '854x480', '854x480', '854x480',
               '1280x720', '1280x720',
               '854x480', '854x480', '854x480',
               '1280x720', '1280x720')
RESOLUTIONS_H = (240, 240, 240,
                 360,
                 480, 480, 480,
                 720, 720,
                 480, 480, 480,
                 720, 720)
LEVELS = ('2.1', '2.1', '2.1',
          '3.0',
          '3.0', '3.0', '3.0',
          '3.1', '3.1',
          '3.0', '3.0', '3.0',
          '3.1', '3.1')
FFMPEG_FLAGS = ('', '', '',
                '',
                '', '', '',
                '', '',
                '-bf 0', '-bf 0', '-bf 0',
                '-bf 0', '-bf 0')


# DRM variables
WIDEVINE_LICENSE_URL = 'http://widevine.videopass.kkbox-test.com/'
PLAYREADY_LICENSE_URL = 'http://playready.videopass.kkbox-test.com/playready/rightsmanager.asmx?'
PLAYREADY_LOGIN_URL = 'http://playready.videopass.kkbox-test.com/playready/rightsmanager.asmx?'  # FIXME
#KEY_SERVER_URL = 'http://54.238.126.15/~ubuntu/key_server/get_key_pair.php'
KEY_SERVER_URL = 'http://key.vp-test/get_key_pair.php'  # TODO: this server in AWS VPC now.
SERVER_ID = ''  # FIXME
MP4BOX_DRM_INFO_FILENAME = 'drm_info.xml'
WIDEVINE_SYSTEM_ID = 'edef8ba979d64acea3c827dcd51d21ed'
PLAYREADY_SYSTEM_ID = '9a04f07998404286ab92e65be0885f95'


# DASH adaptive streaming variables
SEG_LENGTH = 5000
FRAG_LENGTH = 1000
MPD_FILENAME = 'movie.mpd'
MPD_TMP_FILENAME = 'movie_tmp.mpd'


# HLS adaptive streaming variables
HLS_FILENAME = 'movie.m3u8'
HLS_TMP_FILENAME = 'movie_tmp.m3u8'


# MSS adaptive streaming variables
MSS_RESOLUTIONS = ('480', '720')
MPD2MSS_FOLDER = 'dash2mss'


# (Working) path variables
DIR_OUTPUT = 'output'
DIR_ISOURCE = os.path.join(DIR_OUTPUT, 'isource')
DIR_DASH = os.path.join(DIR_OUTPUT, 'dash')

TMP_DIR1 = '/data1/tmp'
TMP_DIR2 = '/data2/tmp'
LOCAL_TMP_DIR = '/tmp/videopass-encoding'


# S3 bucket variables
S3_BUCKET_DEFAULT = 'videopass-theater'
S3_BUCKET_SOURCE = S3_BUCKET_DEFAULT
S3_BUCKET_ISOURCE = S3_BUCKET_DEFAULT
S3_BUCKET_ENC_ISOURCE = S3_BUCKET_DEFAULT
S3_BUCKET_PACKAGE = S3_BUCKET_DEFAULT
S3_BUCKET_STAGE = S3_BUCKET_DEFAULT
S3_BUCKET_RELEASE = S3_BUCKET_DEFAULT
S3_BUCKET_WEB = S3_BUCKET_DEFAULT
# S3 object prefix variables
S3_SOURCE_PREFIX = 'mezzanine/'
S3_ISOURCE_PREFIX = 'isources/'
S3_ENC_ISOURCE_PREFIX = 'encrypted_isources/'
S3_ADAPTIVE_PREFIX = 'adaptive/'
S3_STAGE_PREFIX = 'stage/'
S3_RELEASE_PREFIX = 'release/'
S3_DASH_PREFIX = 'dash/'
S3_HLS_PREFIX = 'hls/'
S3_MSS_PREFIX = 'mss/'


# back-end API variables
API_URL = path.path('http://api-videopass-cms.videopass.kkbox-test.com')
API_VERSION = 'v1'
API_URL = API_URL / API_VERSION
INGESTION_REPORT_API_URL = API_URL / 'content_ingestion_reports'
VIDEO_API_URL = API_URL / 'search/kddi_video'
INGESTION_REPORT = True


# Web variables
WEB_MARKDOWN_FILEPATH = 'web/index.markdown'
WEB_JSON_FILEPATH = 'web/adaptive_streaming_packages.json'
WEB_HTML_FILEPATH = 'web/index.html'

WEB_HEADER_TML = 'web/template/index_header.markdown'
WEB_FOOTERS_TML = []
WEB_FOOTERS_TML.append('web/template/index_testing_audio.markdown')
WEB_FOOTERS_TML.append('web/template/index_trailer.markdown')
WEB_FOOTERS_TML.append('web/template/index_reference.markdown')
WEB_FOOTERS_TML.append('web/template/index_footer.markdown')


# Gearman variables
GEARMAN_JOB_SERVERS = ('54.64.70.202', '54.64.63.31')
GEARMAN_ROOT_SCRIPT_PATH = '/home/ubuntu/videopass-encoding/scripts/'

SKIP_ENCRYPT_DASH = False
SKIP_ENCRYPT_HLS = False
SKIP_ENCRYPT_MSS = False
SKIP_DEPLOY_DASH = False
SKIP_DEPLOY_HLS = False
SKIP_DEPLOY_MSS = False

# AWS SWF variables
SWF_DOMAIN = 'wesley-swf'
SWF_WORKFLOW_NAME = 'TranscodeWorkflow'
SWF_WORKFLOW_VERSION = '1.0'
# AWS TaskList variables
SWF_TASKLIST_PREFIX_SMART = 'smart_'
SWF_TASKLIST_PREFIX_SPECIAL = 'special_'
SWF_TASKLIST_SOURCE_INSPECTION = 'default'
SWF_TASKLIST_TRANSCODE = 'transcode'
SWF_TASKLIST_ADAPTIVE = 'default'
SWF_TASKLIST_ENCRYPT = 'default'
SWF_TASKLIST_DEPLOY = 'default'
